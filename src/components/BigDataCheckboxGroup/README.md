[[toc]]

# 复选框组

- 若搜索出的结果为0
    - 展示暂无数据
- 若搜索出的结果小于等于设置的最大值
    - 显示全选 和 全选当前页
- 若搜索出的结果大于设置的最大值
    - 显示 全选当前页 和 全选前XXX项

# 方案1

- 使用计算属性
    - get控制上方操作复选框的选中
    - set控制下方选中的复选框keys的选中数组

- 100w
    - 无限制
        - 初始化赋值 19s
        - 全选 5-6s
        - 单个选 6-7s
        - 全选当前页 6s
        - 翻页 6-7s
    - 限制最大勾选100
        - 全选当前页 7-8s
        - 全选前100 7-8s
        - 单个选 8-9s
        - 翻页 6-7s

- 100w
    - 无限制
        - 初始化赋值 25s - 使用 Object.freeze 冻结后12-13s
        - 全选 6-7s 8-9s
        - 单个选 8s 10s
        - 全选当前页 8-9s
        - 翻页 8-9s
    - 限制最大勾选1000
        - 初始化赋值 25s
        - 全选当前页 9-10s
        - 全选前1000 8-10s
        - 单个选 10s
        - 翻页 8s

- 30w
    - 无限制
        - 初始化赋值 3-4s
        - 全选 2-3s
        - 单个选 3-4s
        - 全选当前页 3-4s
        - 翻页 3-4s
    - 限制最大勾选1000
        - 初始化赋值 8-9s
        - 全选当前页 3-4s
        - 全选前1000 6-7s
        - 单个选 3-4s
        - 翻页 3-4s

# 方案2

- 在watch中监听勾选下方选中的复选框keys的选中数组的变化
    - 设置上方操作复选框的选中

- 在点击顶部复选框变化的change事件中
    - 设置下方复选框keys的选中

- 100w
    - 无限制
        - 初始化赋值 19s
        - 全选 4-5s
        - 单个选 4-5s
        - 全选当前页 4s
        - 翻页 6s
    - 限制最大勾选100
        - 全选当前页 15s
        - 全选前100 15s
        - 单个选 13s
        - 翻页 16s

- 100w
    - 无限制
        - 初始化 23s - 使用 Object.freeze 冻结后12s
        - 全选 5-6s
        - 单个选 5-6s
        - 全选当前页 6s
        - 翻页 7s
    - 限制最大勾选1000
        - 全选当前页 17-19s
        - 全选前1000 16s
        - 单个选 15s
        - 翻页 15-16s

- 30w
    - 无限制
        - 初始化赋值 4s
        - 全选 2-3s
        - 单个选 2-3s
        - 全选当前页 2-3s
        - 翻页 3s
    - 限制最大勾选1000
        - 初始化赋值 8-9s
        - 全选当前页 4-5s
        - 全选前1000 6-7s
        - 单个选 4-5s
        - 翻页 6-7s

# 方案3

- 当前页的选中项，不再使用计算属性，而是直接从data中获取
    - 在点击复选框发生变化时，将变化项添加到选中的keys或从选中的keys中移除
    - 监听选中的keys,变化时，重新计算当前页的选中keys
    - 监听当前页keys,变化时，重新计算当前页选中的keys

- 100w
    - 无限制
        - 初始化 25s - 使用 Object.freeze 冻结后12s
        - 全选 4-5s
        - 单个选 5-6s
        - 全选当前页 4-5s
        - 翻页 7-8s
    - 限制最大勾选1000
        - 初始化赋值 38s
        - 全选当前页 15-19s
        - 全选前1000 14-15s
        - 单个选 27-29s
        - 翻页 18-19s

- 30w
    - 无限制
        - 初始化赋值 4s
        - 全选 2-3s
        - 全选当前页 2-3s
        - 单个选 2-3s
        - 翻页 3s
    - 限制最大勾选1000
        - 初始化赋值 8-9s
        - 全选当前页 4-5s
        - 全选前1000 4-5s
        - 单个选 7s
        - 翻页 5-6s

# 方案4

> 尽量避免使用 watch和 computed

- 点击全选所有
    - 全选
        - 将所有keys赋值给 选中的keys
        - 将当前页的所有数据keys 赋值给当前页选中的keys
        - 将选中本页设置为true
    - 取消全选
        - 清空所有选中的keys
        - 清空当前页选中的keys
        - 将选中本页设置为false
- 点击全选本页
    - 全选
        - 获取当前页所有keys,赋值给当前页选中的keys
        - 遍历当前页所有keys,若key 不在全选的keys中，添加进去
    - 取消全选本页
        - 将当前页选中的keys清空
        - 将选中本页设置为false
        - 从所有选中项keys数组中移除当前页keys

- 设置数据
    - 默认搜索出的就是所有数据
    - 调用获取当前页数据的方法
- 获取当前页数据的方法
    - 根据分页参数获取数据
    - 将获取到的数据赋值给当前页数据
    - 判断 全选本页是否选中 - 根据当前页数据中的keys，判断是否全部在已选keys中,如果都包含，则选中本页
- 搜索数据
    - 将之前选中keys清空
    - 全选所有和全选本页设置为false
    - 根据关键词从所有数据中过滤出符合条件的数据
    - 调用获取当前页数据的方法
- 每页大小改变时
    - 将当前页码重置为1
    - 调用获取当前页数据的方法
    - this.$forceUpdate();
    - 注意，勾选记录不清空，只有搜索条件改变时，才清空

- 当前页码改变时
    - 获取当前页数据

- 100w
    - 无限制
        - 初始化 25s - 使用 Object.freeze 冻结后12s
        - 全选 4-5s
        - 单个选 5-6s
        - 全选当前页 4-5s
        - 翻页 4s
    - 限制最大勾选1000
        - 初始化赋值 33s
        - 全选当前页 15-19s
        - 全选前1000 17-18s
        - 单个选 27-29s
        - 翻页 22s

- 30w
    - 无限制
        - 初始化赋值 4s
        - 全选 2-3s
        - 全选当前页 2s
        - 单个选 2s
        - 翻页 3-4s
    - 限制最大勾选1000
        - 初始化赋值 8-9s
        - 全选当前页 4-5s
        - 全选前1000 4-5s
        - 单个选 7-8s
        - 翻页 4-5s

# 方案5

全部勾选项使用set记录，当前页的勾选项仍然使用数组，因为 v-model绑定的是数组

- 点击全选前XXX的时候，会先触发计算属性，然后视图才更新，所以性能会差一些

# 结论：

- 在100w时，无限制的话，方案2更快，开启限制的话，方案1更快
- 30w时，无限制的话方案4更快，开启限制的话，方案3更快
- v-model 绑定计算属性的时候会很耗时，但是大数据量下变化不明显

若最大限制数为50，每页100条

- 初始值
    - 第一页 可勾选 50
    - 第二页 可勾选 0

- 若第一页勾选49
    - 第二页可勾选 1

## max值的计算时机

- 翻页
- 全选前xxx条
    - 假如在最后一页，点击了全选前xxx条，可能此时当前页需要全部禁用
- 全选当前页

- 注意：当前页具体某个复选框选中状态改变的时候，不需要重新计算max
